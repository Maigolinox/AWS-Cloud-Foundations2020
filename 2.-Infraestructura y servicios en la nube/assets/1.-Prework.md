# Prework Sesi√≥n 2



# Introducci√≥n
AWS es un entorno complejo, hay docenas de servicios que pueden ser manejados con diferentes herramientas, pero antes de hacer eso es necesario comprender la forma en que AWS organiza su propia infraestructura y en consecuencia sus servicios, conocer de entre todos los servicios cuales son los servicios principales (spoiler: son principales por que otros servicios usan estos servicios principales) y por que pueden representar ventajas con respecto a otros modelos de infraestructura.


# 1. Objetivo üéØ
+ Conocer la interfaz de AWS Console (portal web).
+ Comprender las formas de interacci√≥n con los servicios de AWS.
+ Explorar la taxonom√≠a de la infraestructura global de AWS.
+ Conocer los servicios principales de AWS.
+ Quedar claro con las ventajas que representa consumir servicios en la nube.
+ Evitar sorpresas desagradables en la factura de fin de mes, si se tiene una sorpresa brindar las herramientas necesarias para detectar el problema.

# 2. Instrucciones üìã
- Se revisar√°n los conceptos b√°sicos sobre la infraestructura de AWS, atender los enlaces externos para formar mas contexto al respecto.

# 3. Desarrollo üìë


## ¬øPor qu√© AWS?

Seg√∫n [Gartner](https://www.gartner.com/reviews/market/public-cloud-iaas/vendor/amazon-web-services/product/amazon-web-services/ratings?reviewRating=3&sort=-helpfulness), el rubro de integraci√≥n y despliegue es marcado con un 4.6/5 de excelencia, en general el despliegue toma menos de tres meses, lo que es un tiempo razonable (aunque hay que decir que no se menciona el tama√±o de las organizaciones), en temas de soporte que es muy importante tambi√©n se encuentra con un 4.6/5, las organizaciones encuentran muy bueno el tiempo de respuesta y la calidad del soporte recibido es muy buena. En cuanto a servicios la calificaci√≥n va de 4.7/5 con el puntero en servicios de c√≥mputo (EC2), user management y networking, tambi√©n seguridad y apego a est√°ndares son muy bien calificados. 


# Interactuando con AWS y configuraci√≥n de cuentas
Al ingresar la cuenta de AWS lo primero que veremos es lo siguiente:

![interactuando-con-la-consola](interactuando-con-la-consola.png)


1.- Muchos de los servicios de AWS operan en regiones espec√≠ficas, desde este men√∫ se selecciona la regi√≥n para poner en marcha servicios de AWS, ¬øqu√© tal desplegar la p√°gina web de la organizaci√≥n en Londres?

2.-Las alertas brindan informaci√≥n sobre algunas fallas o degradamiento de servicios que puede presentar AWS, es especialmente importante cuando el usuario final reporta problemas con el software ejecut√°ndose sobre AWS, se pueden ver las alarmas y verificar si uno de los servicios de la aplicaci√≥n esta implicado en problemas.

3.- En el men√∫ soporte se pueden dar de alta tickets de soporte y dependiendo del plan de soporte va desde reportar problemas y aclaraciones con la facturaci√≥n hasta reportar ca√≠das de los aplicativos. Aqui se pide tambi√©n a AWS aumentar el l√≠mite de los recursos de la cuenta. El soporte esta disponible el Japon√©s e Ingl√©s v√≠a web o telef√≥nica.

4.- En el men√∫ de usuario se pueden administrar las tarjetas para hacer los pagos, asociar otras cuentas para administrarlas, ver las facturas y establecer pol√≠ticas de seguridad en cuanto a la cuenta se refiere.

5.- El men√∫ de servicios se puede navegar entre todos los servicios de AWS disponibles en cualquier momento.

6.- El men√∫ grupo de recursos contiene herramientas que ayudar√°n a organizar los recursos de AWS que utilizados. Con los grupos de recursos se agrupan servicios en la misma regi√≥n, tambi√©n se pueden poner etiquetas a los recursos que usados a fin de utilizar como par√°metros de filtrado en otras secciones como el Explorador de costos.


Lo m√°s importante y lo primero a realizar a tener una cuenta de AWS es habilitar el doble factor de autenticaci√≥n, con ello se disminuye la probabilidad dr√°sticamente que alguien use la cuenta de una manera no autorizada o en el peor de los casos secuestren la cuenta con todos los recursos, datos y aplicaciones que se est√©n ejecutando en ella. Si es una cuenta personal tal vez las consecuencias sean m√≠nimas, pero si es una cuenta de un cliente donde tiene toda su empresa se puede volver un problema muy grave si alguien no autorizado gana acceso a la cuenta. Para habilitarlo habr√° que ir al men√∫ de usuario, dar click en ‚ÄúMis credenciales‚Äù y de ah√≠ click en el bot√≥n  ‚ÄúHabilitar MFA‚Äú, la manera mas com√∫n es usar alguna aplicaci√≥n como Google Authenticator, solo que hay que tomar en cuenta que si se da√±a el celular o se pierde se corre el riesgo a ya no tener acceso a la cuenta de AWS, una alternativa es la app [Authy](authy.com), que puede ser configurada en m√∫ltiples dispositivos incluidas laptops y PC de escritorio con lo que se reduce la probabilidad de dejar de tener acceso, y claro, siempre se puede acceder con una clave secreta mostrada al momento de dar de alta el factor m√∫ltiple de autenticaci√≥n, esta clave se debe guardar ante la falta de acceso a los dispositivos con el token.

![multifactor.png](multifactor.png)


# AWS Console, AWS CLI & AWS SDK
En general se puede interactuar con los recursos y servicios que brinda AWS de 3 modos distintos. 

## AWS Console: 
Para la gente visual, esta es la forma mas natural para tener un primer acercamiento con AWS, al entrar al [portal web](console.aws.amazon.com/) de la consola de AWS se pueden ver y gestionar los diferentes recursos que ofrece AWS.

Esta es la apariencia que tiene la consola de administraci√≥n de AWS hasta Agosto del 2020.
![aws-console](aws-console.png)

El elemento principal de la consola es el buscador de servicios que ofrece, sin el buscador es f√°cil perderse entre los 175 que se ofrecen.
Desde aqu√≠ se pueden manejar: 

- Cuotas: Hay servicios de AWS que tienen l√≠mites predefinidos, por ejemplo con las instancias de m√°quinas virtuales (EC2) son [estas](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-on-demand-instances.html#ec2-on-demand-instances-limits).
![Cuotas](aws-console-cuotas.png), desde esta secci√≥n se puede apelar a aumentar las cuotas de los servicios si la operaci√≥n de la organizaci√≥n as√≠ lo requiere. Es importante se√±alar que hay cuotas de tipo `soft` que pueden ser cambiadas solicitando a AWS un aumento y de tipo `hard` que no pueden ser cambiadas. [Por ejemplo](https://docs.aws.amazon.com/mediapackage/latest/ug/live-quotas.html).

- Facturaci√≥n: Tener visibilidad de los costos, presupuestos y m√©todos de pago es muy importante para la correcta gesti√≥n y estrategia en los activos de TI hospedados en AWS.
![Facturacion](aws-console-facturacion.png). 
Aqu√≠ hay mucha ayuda visual sobre la cantidad de dinero gastada mes a mes, se puede entrar al detalle de la facturaci√≥n para saber cu√°nto dinero es gastado por cada recurso de AWS, se pueden establecer presupuestos y alarmas si es que dichos presupuestos se rebasan tambi√©n es posible configurar el envi√≥ de reportes con detalle para personas de la organizaci√≥n en intervalos definidos.

- Configuraci√≥n de la cuenta: Se gestionan los datos propios de la cuenta como nombre del propietario de la cuenta,  tel√©fono y direcci√≥n al igual la gesti√≥n de contrase√±a.
![mi cuenta](aws-console-mi-cuenta.png)

- Organizaciones: AWS provee los mecanismos necesarios para el manejo de m√∫ltiples cuentas centralizadamente.
![organizaciones](aws-console-organizaciones.png). Por ejemplo, se pueden manejar desde aqu√≠ las cuentas de los clientes si se provee alg√∫n servicio de consultor√≠a, as√≠ los clientes no tienen que dar acceso de su cuenta principal al consultor.


## AWS CLI

Tambi√©n existe la opci√≥n de manejar los recursos de AWS por medio de l√≠nea de comandos  disponible para los sistemas [operativos mas comunes](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html), es c√≥modo usar la l√≠nea de comandos ante tareas repetitivas que exijan automatizaci√≥n, se deben descargar archivos a diario desde S3?, es posible generar un script de linea de comandos que lo haga por el administrador, as√≠ no hay que preocuparse por entrar a la consola web que tiende a ralentizar el proceso.

![aws-cli](aws-cli.png)

# AWS SDK
Para los programadores tambi√©n hay opci√≥n de manejar los servicios de AWS desde su [lenguaje de programaci√≥n](https://aws.amazon.com/es/tools/) de preferencia, Ruby, Python, PHP, Node.js, .NET, JavaScript, C++, Go y Java son los lenguajes soportados. ¬øC√≥mo se puede usar?, se puede generar una aplicaci√≥n web que en lugar de guardar las im√°genes de las identificaciones de los usuarios en el disco duro del servidor las guarde directamente en el servicio de S3 de AWS.

# Infraestructura Global de AWS (AWS Regions, Availability Zones, AWS Edge Locations, and Local Zones)

El concepto de nube puede sonar un tanto abstracto, pero al final no hay que dejar de recordar que son un conjunto de m√°quinas agrupadas en un edificio en alg√∫n lugar del planeta.

Amazon Web Services tiene centros de datos lleno de servidores por todo el planeta buscando brindar a los usuarios disponibilidad, rendimiento, escalabilidad, y flexibilidad.

Los conceptos claves que ayudar√°n a comprender como AWS tiene distribuidos todos sus servidores por el mundo son:
- Zonas de disponibilidad:
Los distintos centros de datos de Amazon por el mundo los agrupa las llamadas zonas de disponibilidad. Cada zona de disponibilidad puede constar de mas de un centro de datos, cada zona de disponibilidad se comunica con otras zonas de disponibilidad por medio de enlaces de baja latencia.
La raz√≥n de segmentar una zona de disponibilidad en varios centros de datos con algunos kil√≥metros de distancia es ser resilientes ante desastres naturales, fallas de energ√≠a el√©ctrica, atentados o alg√∫n otro inconveniente, mas adelante se ver√° como maximizar la tolerancia a fallos de los aplicativos si se alojan en mas de una zona de disponibilidad.

- Regiones: 
Son puntos geogr√°ficos distantes donde se agrupan varias zonas de disponibilidad.
AWS tiene actualmente 245 pa√≠ses con 24 regiones lanzadas, anunciadas 3 por lanzar en Indonesia, Jap√≥n y Espa√±a.

- Local Zones:
A√∫n esta en una etapa temprana de desarrollo, solo se encuentra una local zone disponible en Los Angeles California, pretende proveer servicios de baja latencia a usuarios finales acercando la infraestructura de AWS sin necesidad de tener una zona de disponibilidad cercana.

- Wavelength:
Ofrecer√° acceso √≥ptimo en latencia a recursos de AWS por medio de redes 5G. A√∫n es un servicio muy cerrado a los Estados Unidos de Am√©rica.

- Edge locations:
Son centros de datos manejados por partners certificados de AWS que tiene conexi√≥n directa a la infraestructura de AWS. Es usado por los servicios como Route53 (servicio de DNS), CloudFront (Content Delivery Network) y API Gateway (creaci√≥n, publicaci√≥n y mantenimiento de API). La idea es proporcionar baja latencia a los usuarios finales no importando si se encuentran cerca de una regi√≥n de AWS.



Ejemplo de las zonas de disponibilidad de la regi√≥n 1, en ella se aprecian las zonas de disponibilidad (conunto de centros de datos) conectadas por redes de baja latencia. As√≠ si la zona de disponibilidad us-east-1f tiene bajo performance por fallas por energ√≠a el√©ctrica las aplicaciones pueden seguir operando si est√°n distribuidas en m√°s de una zona de disponibilidad. Algunos servicios como RDS obligan al [provisionar](www.redhat.com/en/topics/automation/what-is-provisioning) una base de datos establecer la red en dos zonas de disponibilidad como m√≠nimo. 

### Nota: En general los servicios de AWS son muy resistentes a fallas, hay que evaluar bien si la aplicaci√≥n a ejecutar justifica el uso de recursos replicados en m√°s de una zona de disponibilidad, ya que los recursos replicados aunque no se usen al final cuestan pr√°cticamente lo mismo que los recursos que si se est√°n utilizando, dicho de otro modo, la infraestructura total cuesta aproximadamente el doble.

![aws-regions-availability-zone](aws-regions-availability-zone.png)


La mayor√≠a de los servicios que ofrece AWS son inherentes a una regi√≥n espec√≠fica, si se desea provisionar un servidor virtual (EC2) en China habr√° que desplazarse en la consola AWS (o especificar en aws-cli o aws-sdk) a la regi√≥n deseada. Aunque hay algunas excepciones, servicios como IAM (gesti√≥n de usuarios, pol√≠ticas de acceso y permisos), Cloud CloudFront (Content Ddelivery Network) y S3 (Almacenamiento masivo de archivos) se consideran que no pertenecen a ninguna regi√≥n espec√≠fica, son considerados servicios globales. 

# Servicios Centrales
Los siguientes servicios son centrales para tener una unidad de procesamiento computacional operando en AWS:

- IAM: Es uno de los pilares de la seguridad en AWS ya que administra el acceso a servicios y recursos de AWS.
Pr√°cticamente es un servicio omnipresente, estar√° en cualquier servicio u aplicaci√≥n a desplegar en la nube no importanto si es muy peque√±a o muy grande.
IAM permite definir permisos a niveles muy granulares lo que da mucha flexibilidad a la hora de definir quien puede acceder y que puede hacer en los recursos usados.
IAM soporta la estrategia de autorizaci√≥n Attribute-based access control (ABAC) por medio de TAGS en los recursos, con lo que se pueden definir pol√≠ticas de acceso o denegacion a un servicio basadas solo en las etiquetas de los recursos.
Tambi√©n soporta la estrategia de autorizaci√≥n role-based access control (RBAC). Se pueden definir permisos (policies) en este caso a los usuarios mismos que que se crean en AWS.
Siempre se debe garantizar que las cuentas que acceden a los recursos cumplan con en principio de m√≠nimo privilegio.


- VPC (Virtual Private Cloud):
Los recursos de AWS deben comunicarse unos con otros. Las maquinas virtuales ejecutadas por el servicio EC2, las funciones Lambda, las bases de datos de RDS son solo algunos ejemplos de servicios que requieren especificar una conexi√≥n de red para poder funcionar. 
El espacio donde se pueden configurar esas redes se conoce como VPC, que no es mas que una entidad l√≥gica que contiene distintos componentes de red en una regi√≥n dada.
Una regi√≥n puede tener configuradas varias VPC, se puede configurar una VPC para cada departamento de una organizaci√≥n, as√≠ se tendr√≠a una VPC para todo el departamento financiero y una para todo el departamento de IT, ¬øqu√© se gana?, aislamiento, por defecto los recursos contenidos dentro de una VPC no pueden comunicarse, aunque si hay forma de hacerlo, es posible establecer un [AWS PrivateLink](https://aws.amazon.com/es/privatelink/) que en conjunto con un router de AWS puede redireccionar ese tr√°fico a subredes muy espec√≠ficas, si ese tr√°fico se desea asegurar m√°s se pueden configurar las ACL (Network access control list) a una o varias subredes configurando el tipo de tr√°fico que ser√° permitido para entrar y salir, si a√∫n eso no es suficiente se puede configurar un firewall adicional que opera a nivel de m√°quina virtual EC2 llamado security group.
Todo eso funciona cuando es tr√°fico interno, pero cuando llegue el momento de comunicar servicios desde y hacia internet se tiene que agregar a la VPC los llamados NAT gateways y los Internet Gateways, el primero hace posible comunicar recursos que se encuentran en una subred que no debe tener acceso directo a internet como pueden ser redes dedicadas de base de datos, de hecho la forma para hacer una subred privada es que no tenga forma de routear tr√°fico hacia un Internet Gateway, Por otro lado un Internet Gateway es el mecanismo que da acceso desde internet hacia los recursos mapeando 1:1 una IP p√∫blica [(Elastic IP)](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-eips.html), el tr√°fico hacia internet tambi√©n es gestionado por Internet Gateway. Solo puede haber un √∫nico Internet Gateway por VPC, AWS garantiza que no se convertir√° en un cuello de botella o un punto √∫nico de falla ya que tras bambalinas Internet Gateway es redundante y escalable.


La forma en que se organizan las redes en AWS no es muy diferente a como se hacen en un centro de datos tradicional, en AWS existe el concepto an√°logo de subred sobre la cual se define el espacio de direcciones IP [(CDIR)](https://whatismyipaddress.com/cidr) que la red puede solventar.
Las subredes aqu√≠ tienen la particularidad que est√°n sociadas a una y solo una zona de disponibilidad, al generar las subredes habr√° que tener cuidado donde son creadas y que niveles de alta disponibilidad se desea y claro, el presupuesto con el que se cuenta ya que los datos entre zonas de disponibilidad tienen costo pro GB en ambas direcciones.
Para la redirecci√≥n y manejo del tr√°fico se cuentan en AWS con Routers, los routers definen las reglas o rutas que determinan a donde ser√° dirigido el tr√°fico.
Se pueden comunicar las subredes desde y hacia internet con NAT Gateway e Internet Gateway.
VPC se puede conectar a las instalaciones de la organizaci√≥n por VPN con un Virtual Private Gateway, habilitando as√≠ el acceso a la red h√≠brida conectando infraestructura propia con la nube brindando lo mejor de los dos mundos.



- S3 (`S`imple `S`torage `S`ervice):

S3 es uno de los servicios ic√≥nicos de AWS. S3 lanzado en 2006 se ha convertido en el storage por excelencia a la hora de guardar archivos (objetos) a precios bajos con tiempos de acceso de milisegundos, el hecho de ser altamente resistente a p√©rdida de archivos ofreciendo un 99,999999999 % de durabilidad de datos (si se almacenan 10 000 objetos se espera una p√©rdida de un objeto cada 10¬†000¬†000 a√±os) brinda mucha seguridad y confianza.
S3 cuenta con diferentes niveles de servicio y precios, hay tipos de storage mas baratos pero el tiempo de acceso a los datos es mayor, si se requiere acceso a datos en el orden de los milisegundos el storage tiende a ser mas costoso.
La forma de trabajar con S3 es por medio de `buckets`, los buckets son un contenedor de archivos u objetos, a cada bucket se le puede asignar un nombre √∫nico que no puede ser usado en ninguna otra regi√≥n ni en ninguna otra cuenta de AWS, los buckets tambi√©n pueden ser configurados con pol√≠ticas de seguridad, aqu√≠ tambi√©n es donde se especifica el nivel de storage a requerir y en consecuencia los costos que incurrir√°n.
Los casos de uso comunes para S3 incluyen backups por su porcentaje de durabilidad, datalakes por su capacidad de escalamiento de unos cuantos gigabytes a petabytes sin esfuerzo, como storage para datos no utilizados que se deben guardar por regulaciones y como web server.


Un uso interesante adem√°s de guardar las facturas de clientes y proveedores que por reglamentaci√≥n oficial en M√©xico se deben guardar tenerlas almacenadas por 5 a√±os a bajo costo. 
Otra posibilidad de habilitar un bucket de S3 como un servidor web est√°tico, hay algunas consideraciones, para poder darle un dominio a ese bucket el DNS de del dominio debe ser manejado por el servicio Route53, y para poder habilitar el certificado https se hace uso de AWS CloudFront y AWS Certificate Manager.


- EC2 y EBS
Elastic Compute Cloud, o EC2, es uno de los servicios de AWS enfocados en proveer una capa de c√≥mputo a las aplicaciones. EC2 en particular permite la creaci√≥n de m√°quinas virtuales, tambi√©n conocidas como instancias, a las cuales se les asigna una capacidad de c√≥mputo espec√≠fica en t√©rminos de la cantidad y tipos de CPU, la cantidad de memoria RAM y el espacio en disco para almacenamiento. 

Adicionalmente, EC2 permite seleccionar el sistema operativo que se desea instalar en la **instancias** y con esto **entrega** una m√°quina virtual completamente funcional en cuesti√≥n de segundos, sobre las cuales los usuarios podr√°n desplegar aplicaciones y servicios de la misma manera que lo har√≠an en un servidor on-premise o en una m√°quina virtual desplegada en cualquier otro hipervisor.

Las instancias EC2 requieren de una conexi√≥n de red en AWS para funcionar. Aqu√≠ es donde se debe tener previamente configurada una VPC con las subredes, grupos de seguridad, routing y niveles de disponibilidad necesarios antes de crear una maquina virtual.

Otro elemento fundamental en las instancias ec2 es el storage donde los datos ser√°n alojados. Este storage es conocido como Elastic Block Storage. Amazon EBS proporciona vol√∫menes de almacenamiento duraderos a nivel de bloque que pueden ser adjuntados a una instancia en ejecuci√≥n. Es posible utilizar Amazon EBS como dispositivo de almacenamiento principal para los datos que requieren actualizaciones frecuentes y granulares.  Por ejemplo, Amazon EBS es la opci√≥n de almacenamiento recomendada cuando ejecuta una base de datos en una instancia.

Un EBS se comporta como un dispositivo de bloque externo **sin formato y sin formato que puede adjuntar** a una sola instancia.  El volumen persiste independientemente de la vida √∫til de una instancia.  Una vez que se adjunta un volumen de EBS a una instancia, puede usarse como cualquier otro disco duro f√≠sico.


AWS cuenta con varios tipos de instancias dependiendo de las necesidades espec√≠ficas de la aplicaci√≥n, se tienen:

|Tipo de instancia | ¬øpara que usar?                | Casos de uso
|-----------------:|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
|A1                | Fin general                    | Servidores web, Microservicios en contenedores|
|C4                | Optimizada para computaci√≥n    | Flotas frontend de alto rendimiento, servidores web, procesamiento por lotes|
|C5                | Optimizada para computaci√≥n    | Deducciones de Machine learning y otras aplicaciones que requieran un uso intensivo de recursos inform√°tico|
|C5a               | Optimizada para computaci√≥n    | Usos que requieren un ancho de banda alto de CPU virtual y memoria, como el procesamiento por lotes, el an√°lisis distribuido, las transformaciones de datos|
|C5ad              | Optimizada para computaci√≥n    | Usos que requieren un ancho de banda alto de CPU virtual y memoria, como el procesamiento por lotes, el an√°lisis distribuido, las transformaciones de datos|
|C5d               | Optimizada para computaci√≥n    | Usos que requieren un ancho de banda alto de CPU virtual y memoria, como el procesamiento por lotes, el an√°lisis distribuido, las transformaciones de datos|
|C5n               | Optimizada para computaci√≥n    | Deducciones de Machine learning y otras aplicaciones que requieran un uso intensivo de recursos inform√°tico|
|D2                | Optimizada para almacenamiento | Inform√°tica distribuida de MapReduce y Hadoop|
|F1                | Computaci√≥n acelerada          | Acelerar algoritmos que usan muchos recursos inform√°ticos|
|G3                | Computaci√≥n acelerada          | Utilizan GPU Tesla M60 de NVIDIA|
|G4                | Computaci√≥n acelerada          | Utilizan las GPU NVIDIA Tesla|
|H1                | Optimizada para almacenamiento | Cargas de trabajo basadas en MapReduce, sistemas de archivos distribuidos como HDFS y MapR-FS, procesamiento de datos o registros como Apache Kafka|
|I3                | Optimizada para almacenamiento | Bases de datos NoSQL |
|l3en              | Optimizada para almacenamiento | Bases de datos transaccionales escalables, sistemas de archivos distribuidos, almacenamiento de datos, Elasticsearch|
|M4                | Fin general                    | Bases de datos de tama√±o peque√±o y mediano|
|M5                | Fin general                    | Bases de datos peque√±as y medianas, Servidores de backend para SAP, Microsoft SharePoint, otras aplicaciones empresariales|
|M5a               | Fin general                    | Bases de datos peque√±as y medianas, Servidores de backend para SAP, Microsoft SharePoint, otras aplicaciones empresariales|
|M5ad              | Fin general                    | Ejecuci√≥n de servidores backend para SAP, Microsoft SharePoint.|
|M5d               | Fin general                    | Ejecuci√≥n de servidores backend para SAP, Microsoft SharePoint.|
|M5dn              | Fin general                    | Ejecuci√≥n de servidores backend para SAP, Microsoft SharePoint.|
|M5n               | Fin general                    | Servidores web y de aplicaciones, bases de datos peque√±as y medianas|
|P2                | Computaci√≥n acelerada          | Utilizan GPU de NVIDIA Tesla K80 |
|P3                | Computaci√≥n acelerada          | Utilizan GPU de NVIDIA Tesla V100|
|P3dn              | Computaci√≥n acelerada          | Utilizan GPU de NVIDIA Tesla V100|
|R4                | Optimizada para memoria        | Bases de datos de alto rendimiento, extracci√≥n y el an√°lisis de datos.|
|R5                | Optimizada para memoria        | Bases de datos de alto rendimiento, las cach√©s en memoria distribuidas de escala web.|
|R5a               | Optimizada para memoria        | Bases de datos en memoria de tama√±o mediano, los an√°lisis de big data en tiempo real |
|R5ad              | Optimizada para memoria        | Bases de datos en memoria de tama√±o mediano, los an√°lisis de big data en tiempo real |
|R5d               | Optimizada para memoria        | Bases de datos en memoria de tama√±o mediano, los an√°lisis de big data en tiempo real |
|R5dn              | Optimizada para memoria        | Bases de datos en memoria de tama√±o mediano, los an√°lisis de big data en tiempo real |
|R5n               | Optimizada para memoria        | Bases de datos en memoria de tama√±o mediano, los an√°lisis de big data en tiempo real |
|T2                | Fin general                    | Sitios web y aplicaciones web,Entornos de desarrollo, compilaci√≥n, pruebas e implementaci√≥n|
|T3                | Fin general                    | Sitios web y aplicaciones web,Entornos de desarrollo, compilaci√≥n, pruebas e implementaci√≥n|
|T3a               | Fin general                    | Sitios web y aplicaciones web,Entornos de desarrollo, compilaci√≥n, pruebas e implementaci√≥n|
|X1                | Optimizada para memoria        | Bases de datos en memoria (p. ej.: SAP HANA), motores de procesamiento de big data (p. ej.: Apache Spark o Presto), inform√°tica de alto rendimiento (HPC).|
|X1e               | Optimizada para memoria        | Bases de datos de alto rendimiento, bases de datos en memoria (por ejemplo, SAP HANA) y aplicaciones con uso intensivo de memoria|
|z1d               | Optimizada para memoria        | Ideal para la automatizaci√≥n del dise√±o electr√≥nico (EDA) |

Importante mencionar que es una Amazon Machine Image (AMI).
Una AMI es una m√°quina virtual pre configurada, usada para crear una m√°quina virtual.


# Niveles y planes de AWS Support

El hecho de no contar con servidores f√≠sicos y evitar todo el mantenimiento que conlleva no quiere decir necesariamente que no se requiera de alg√∫n respaldo o soporte en un momento dado.
La nube de AWS cuenta con 175 servicios al momento, desde storage, redes, bases de datos, anal√≠tica, despliegue y desarrollo por mencionar algunas, por lo que no es dif√≠cil perderse en alg√∫n momento.

Todas las cuentas desde que son creadas cuentan con un plan Basic Support, se puede tener un soporte b√°sico en la [documentacion](https://docs.aws.amazon.com/), y [foros de soporte](https://forums.aws.amazon.com/index.jspa).

Tambi√©n se cuenta con la herramienta Trust Advisor que brinda algunas recomendaciones y alertas en la cuenta de AWS con limitantes o restricciones si no se cuenta con un plan m√°s avanzado.

![trust-advisor](trust-advisor.png)

Tambi√©n se cuenta con la herramienta [`Personal Health Dashboard`](https://aws.amazon.com/es/premiumsupport/technology/personal-health-dashboard/) que avisa si hay problemas con los servicios de AWS y en que medida. 

En la siguiente imagen se observan varios problemas que potencialmente pueden afectar a una aplicaci√≥n dependiente de servicios AWS, ejemplo: si se usa un balanceador de carga y se reporta por parte de AWS en este panel que el servicio de balanceo de carga (Elastic Load Balancer) tiene p√©rdida de paquetes, no habr√° mucho que podamos hacer pero por lo menos da visibilidad de que puede estar fallando antes de comenzar la b√∫squeda y pruebas en el aplicativo.
![persolal-health](persolal-health.png)


Los siguientes son los niveles de soporte ofrecidos por AWS, cada uno da mas respaldo que el anterior, son: Developer,  Bussiness y Enterprise.
Si el aplicativo es relacionado con la industria espacial, sistemas de aguas de una ciudad, sistema de un hospital tal vez sean necesarios tiempos de asesoramiento t√©cnico de menos de 4 horas. Asesor√≠a por parte de un experto en cuanto a arquitectura por mencionar algo tal vez el plan m√°s id√≥neo para este caso es Enterprise, aunque hay que tomar en cuenta que no es un servicio asequible, ya que se tendr√° que estar consumiendo por lo menos 150 000 USD o pagar 15 000 USD al mes para poder acceder a √©l.

Si se tiene una aplicaci√≥n m√°s modesta donde es tolerable una falla de algunas horas no cr√≠tica para la organizaci√≥n se puede optar por el nivel Bussiness, si se facturan por lo menos 100 d√≥lares al mes ya se puede obtener.

### NOTA: no es dif√≠cil alcanzar 100 d√≥lares de cuenta al final de mes, una instancia de RDS de base de datos, un servidor EC2 con 100 GB de storage y un bucket con algunas decenas de gigas rondan alrededor de 67 USD de gastos al mes. Esta aplicaci√≥n no es una aplicaci√≥n de alta demanda, es un portal web para alta y baja de personal.

A continuaci√≥n se detalla.

|||||
|--- |--- |--- |--- |
||Desarrollador|Business|Enterprise|
||Se recomienda si esta realizando pruebas en AWS.|Recomendado si tiene cargas de producci√≥n en AWS.|Recomendado si tiene cargas de trabajo cr√≠ticas o empresariales en AWS.|
|Comprobaciones de pr√°cticas recomendadas de AWS Trusted Advisor|7 comprobaciones principales|Conjunto completo de comprobaciones|Conjunto completo de comprobaciones|
|Soporte t√©cnico mejorado|Acceso por email a los socios de soporte en la nube durante el horario comercial** Casos ilimitados, 1 contacto principal|Acceso por tel√©fono, email y chat a los socios de soporte en la nube las 24 horas y los 7 d√≠as de la semana Casos ilimitados, contactos ilimitados (compatible con IAM)|Acceso por tel√©fono, email y chat a los socios de soporte en la nube las 24 horas y los 7 d√≠as de la semana Casos ilimitados, contactos ilimitados (compatible con IAM)|
|Gravedad de los casos / plazos de respuesta*|Asesoramiento general: < 24 horas**  Fallo en el sistema: < 12 horas**|Asesoramiento general: < 24 horas  Fallo en el sistema: < 12 horas  Fallo en el sistema de producci√≥n: < 4 horas  Sistema de producci√≥n inactivo: < 1 hora|Asesoramiento general: < 24 horas  Fallo en el sistema: < 12 horas  Fallo en el sistema de producci√≥n: < 4 horas  Sistema de producci√≥n inactivo: < 1 hora  Sistema cr√≠tico para la empresa inactivo: < 15 minutos|
|Asesoramiento sobre arquitecturas|Aspectos generales|Contextualizado a sus casos de uso|Asesoramiento y revisi√≥n consultiva en funci√≥n de sus aplicaciones|
|Administraci√≥n de casos de programaci√≥n||API de AWS Support|API de AWS Support|
|Soporte para software de terceros||Interoperabilidad, orientaci√≥n sobre configuraci√≥n y soluci√≥n de problemas|Interoperabilidad, orientaci√≥n sobre configuraci√≥n y soluci√≥n de problemas|
|Programas proactivos||Acceso a Infrastructure Event Management por una tarifa adicional|Infrastructure Event Management Revisiones de Well-Architected Revisiones de operaciones El director t√©cnico de cuenta (TAM) coordina el acceso a los programas y otros expertos de AWS seg√∫n sea necesario|
|Administraci√≥n t√©cnica de cuentas|||Director t√©cnico de cuenta (TAM) asignado para que monitoree de forma proactiva el entorno y apoye con los asuntos relacionados con la optimizaci√≥n|
|Capacitaci√≥n|||Acceso a laboratorios autoguiados online|
|Asistencia para cuentas|||Equipo de soporte Concierge|
|Precios|A partir de 29 USD al mes*** o bien 3¬†% del consumo mensual de AWS ¬† ¬† ¬† Consulte los detalles sobre precios y un ejemplo.|A partir de 100¬†USD al mes*** o bien 10¬†% del consumo mensual dACe AWS para los primeros 0 a 10¬†000 USD 7¬†% del consumo mensual de AWS desde 10¬†000 hasta 80¬†000 USD 5¬†% del consumo mensual de AWS desde 80¬†000 hasta 250¬†000 USD 3¬†% del consumo mensual de AWS por encima de 250¬†000 USD Consulte los detalles sobre precios y un ejemplo.|A partir de 15¬†000 USD o bien, 10¬†% del consumo mensual de AWS para los primeros 0 a 150¬†000 USD 7¬†% del consumo mensual de AWS desde 150¬†000 hasta 500¬†000 USD 5¬†% del consumo mensual de AWS desde 500¬†000 hasta 1¬†000¬†000 USD 3¬†% del consumo mensual de AWS por encima de 1¬†000¬†000 USD Consulte los detalles sobre precios y un ejemplo.|



# Cloud Economics
Hasta se ha navegado por algunos de los principales servicios de AWS, algunas conclusiones son:

- El c√≥mputo en la nube es accesible desde la peque√±a y mediana empresa hasta multinacionales con presupuestos millonarios, tener la capacidad de contratar c√≥mputo para mejorar y ser innovador en procesos en menos de un d√≠a (en c√≥mputo en sitio pod√≠a llevar semanas o meses) es un antes y un despu√©s en el uso de recursos computacionales.

- Flexibilidad: Pagamos por lo que usado, se usa lo que se requiere en un tiempo determinado, hoy la carga de trabajo puede ser alta y ma√±ana no, los recursos se pueden ajustar a estas fluctuaciones, adem√°s, se cuenta con instancias muy peque√±as desde 1 CPU y 512MB de RAM hasta instancias de 128 CPU y 2 TB de memoria, a√±adido a la oferta de instancias con GPU.

- En general el c√≥mputo en la nube con el tiempo tiende a bajar los precios (aunque son centavos a lo largo de varios servicios usando es cuando el ahorro es representativo), AWS a requerir un volumen considerable de suministros como discos, energ√≠a memorias, servidores y redes puede obtener mejores precios en el mercado lo que se traduce en el consumidor en precios relativamente bajos.

- Alta disponibilidad: Se puede acceder a recursos de AWS que se encuentran en varias regiones por todo el mundo, se pueden construir aplicaciones tolerantes a fallas sin salir del pa√≠s.

Indudablemente el c√≥mputo en la nube ayudar√° a generar resultados m√°s r√°pidos, adapt√°ndose a la realidad y necesidades que el software tiene hoy d√≠a.


# Organizaci√≥n y optimizaci√≥n de costos en AWS
Una estrategia de ahorro econ√≥mico es imprescindible a la hora de tener recursos de c√≥mputo ya sea en la nube o en sitio.
Siempre que se habla de optimizaci√≥n es inherente hablar de medir (lo que no se mide no se mejora). AWS ofrece un par de herramientas importantes a la hora de medir los costos que generados.

La primera es AWS Cost Explorer, la segunda no es como tal una herramienta de AWS, es una funcionalidad de AWS para poder identificar los recursos usados.
La siguiente es un panel real de cost explorer.
![cost-explorer](cost-explorer.png)

En el panel se puede ver la informaci√≥n de costos de diferentes maneras.
![cost-explorer-b](cost-explorer-b.png)


EL panel de exploraci√≥n de costos tiene las siguientes funcionalidades:

![cost-explorer](cost-explorer-1.png)
![cost-explorer](cost-explorer-2.png)
![cost-explorer](cost-explorer-3.png)
![cost-explorer](cost-explorer-4.png)
![cost-explorer](cost-explorer-5.png)
![cost-explorer](cost-explorer-6.png)
![cost-explorer](cost-explorer-7.png)

Y en conjunto con Tags de los recursos se vuelve una herramienta poderosa a la hora de ver los costos de los servicios en AWS usados.
![cost-explorer](cost-explorer-etiqueta.png)

¬øQu√© son las etiquetas?
Se pueden poner tantas etiquetas como se requieran a los recursos, con la premisa b√°sica que sean consistentes, si en un lado se nombran los servicios como production, en otro prod y en otro producci√≥n har√° dif√≠cil en an√°lisis de costos.
Las etiquetas al final son texto que se puede adherir a los recursos para identificar los recursos usados, es equivalente al mundo real pegar una etiqueta con un identificador como nombre a un servidor por mencionar un ejemplo.
![tags](tags.png)


¬øQu√© estrategias usar para aminorar costos?

Una estrategia para aminorar costos es la reserva de instancias (RI). Puede ser hecha desde un pago inicial pago intermedio o pago final siempre y cuando haya un compromisos a pagar de 1 a 3 a√±os de instancia, con lo que se puede ahorrar un 69% respecto a los costos bajo demanda.
Instancias permitidas permitidas para ser reservadas son de tipo Amazon EC2, Amazon RDS, Amazon Redshift, Amazon ElastiCache y Amazon Elasticsearch.

Otro m√©todo para ahorro de dinero es hacer uso de un Saving Plan, los saving plans  permiten ahorrar hasta un 72% de costos sobre instancias bajo demanda, en los saving plans se debe especificar un compromiso de gasto por hora de una familia de instancias por tiempos de 1 a 3 a√±os, ej: adquirir un saving plan comprometiendo gastar 1 USD cada hora como m√≠nimo por un periodo de 1 o 3 a√±os.


# Creaci√≥n de presupuestos con AWS Budget
Los budgets o presupuestos permiten tener alarmas para el control de los gastos en los servicios de AWS evitando sorpresas en la facturaci√≥n a final de mes. Es posible definir presupuestos en base a costos donde se establece una cantidad monetaria m√°xima que se desea gastar. 

Tambi√©n es posible establecer alarmas de presupuesto basado en uso, se miden en unidades dependiendo el servicio, en el caso de EC2 se mide por hora de instancia encendida, con S3 en el n√∫mero de requests a los buckets o en GB para la transferencia de datos, ya depender√° del servicio que se desea monitorear la unidad de medida a utilizar.

En el caso de querer monitorear las instancias reservadas se pueden generar presupuestos de reserva, con ellos se puede medir el porcentaje de utilizaci√≥n de la reserva de instancia se tiene consumida o que porcentaje de cobertura se tiene. 

En el caso de presupuestos de saving plans se pueden medir y lanzar alarmas ante un porcentaje de utilizaci√≥n que se defina o bajo un porcentaje de cobertura.


![budgets](budgets.png)

Es importante mencionar que los presupuestos no [son gratis](https://aws.amazon.com/es/aws-cost-management/pricing/), a septiembre del 2020 cuestan 0.02 USD por d√≠a cada uno.

# AWS TCO Calculator, AWS Simple Monthly Calculator & Cost 
Al explorar la posibilidad de una migraci√≥n hacia la nube, muchas veces hay un desacuerdo sobre el costo total de propiedad de los elementos de hardware y de centros de datos existentes.
AWS proporcionan una calculadora TCO flexibles para comparar el costo de funcionamiento de una puesta a punto en local (o baremetal) frente a s√≠ mismo en Amazon Web Services. A la hora de planificar el movimiento hacia la nube muchos departamentos de la empresa est√°n involucrados en la decisi√≥n. Operaciones e ingenier√≠a quiere mirar y desplegar r√°pidamente mientras finanzas quiere gastar menos. La calculadora de AWS puede ayudar a a√±adir un poco de rigor num√©rico para el debate entre √°reas.

No es una tarea f√°cil calcular el costo de migraci√≥n, algunos de los servidores no necesariamente se encuentran trabajando 24/7, o trabajando con un rendimiento de CPU del 100%, por lo que se puede estar subdimensionando o sobredimensionando.

La [calculadora](https://awstcocalculator.com/#) solamente dar√° un estimado de muy alto nivel, un n√∫mero de referencia para partir hacia an√°lisis mas profundos y certeros.


Para estimaci√≥n de costos de uso mensuales se utilizaba [SIMPLE MONTHLY CALCULATOR](https://calculator.s3.amazonaws.com/index.html) la cual result√≥ en muchas veces ser una herramienta poco precisa al dejar de lado m√∫ltiples variables a calcular.

La nueva versi√≥n es [AWS Pricing Calculator](https://calculator.aws/#/createCalculator), esta nueva calculadora contempla m√°s variables para hacer c√°lculos, s√≠, hay que conocer mas informaci√≥n a la hora de usarla pero se convierte al final en una herramienta mas precisa que evitar√° sorpresas amargas al final de mes en la factura.


Para ilustrar mejor imaginar el ejercicio:
Definamos un centro de datos empresarial, con servidores on premise con 10 servidores f√≠sicos, cada unos con unas 10 m√°quinas virtuales cada uno en promedio con 4 GB de RAM, 50 GB de disco duro alojados en una SAN con capacidad de 20 TB en arreglo RAID 5 por lo que ser√°n usables unos 17.3 TB solamente, 2 sockets para procesador, con procesadores Intel¬Æ Xeon¬Æ E5 2600 v4 que tienen 22 n√∫cleos aunque cada maquina virtual usa 4 cores, la mitad con sistema operativo GNU/Linux y otras con Windows, todas ejecutandose en hypervisores de nivel 1 de VMWare,

La calculadora ser√≠a llenada con los siguiente par√°metros:
![tco](TCO.png)

Al final el reporte proporcionado es muy completo, contiene inclusive la descripci√≥n de la metodolog√≠a usada para hacer el c√°lculo.
[Detalle](https://tcoprd.s3.amazonaws.com/2020/2020/2020/358db9d1132436096195664305.xml?AWSAccessKeyId=AKIAJIN5MU5FZ6H45LHA&Expires=1599222692&Signature=4V1sycy7K7JRzFZMXhPCeoSIgUM%3D)

Debe tomarse este estimado con cuidado ya que los c√°lculos descritos en la metodolog√≠a contemplan equipos que pueden diferir de precios, los sueldos de personal tambi√©n difieren y los costos de energ√≠a el√©ctrica, por lo que no se recomienda sea esta una herramienta para tomar la √∫ltima decisi√≥n.


Por otro lado ya operando servicios en AWS surgir√° la duda en cuanto a costos de tener una nueva aplicaci√≥n funcionando, muchas veces es para poder brindar un precio a un tercero que quiera usar un servicio ofrecido por la organizaci√≥n o para el departamento financiero internamente a modo de proyecci√≥n.
Para este caso AWS Pricing Calculator es la herramienta de estimaci√≥n de costos id√≥nea.
Seguir el siguiente ejercicio:
Simular una aplicaci√≥n web de registro de personal de baja carga (pocas altas y bajas al d√≠a), conformada por un servidor EC2 y una base de datos de RDS, adem√°s la organizaci√≥n cuenta con otro servidor EC2 ejecutando un LMS(Moodle).

Ambas instancias son del tipo t2.small, tiene una transferencia hacia internet de no mas de 1 GB al mes, la base de datos es de RDS es de tipo t3.small Maria DB, con un disco de 30 GB.

AL final la [calculadora](https://calculator.aws/#/estimate?id=dc483dba879f7338a02be8bcf2c50959d53ad9f1) da un precio al mes de 78.80 USD


Esta infraestructura en producci√≥n al mes tiene el siguiente hist√≥rico de billing que es sorprendentemente similar.

![calculadora-mensual](calculadora-mensual.png)
